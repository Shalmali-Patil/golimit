<html>
<head>
    <title>Shield</title>
    <link type="text/css" rel="stylesheet" href="ui/lib/jsgrid.min.css" />
    <link type="text/css" rel="stylesheet" href="ui/lib/jsgrid-theme.min.css" />
    <script type="text/javascript" src="ui/lib/jquery.min.js"></script>
    <script type="text/javascript" src="ui/lib/jsgrid.min.js"></script>
 
    <script>
    

        $("document").ready(function() {
            $("#jsGrid").jsGrid({
            width: "100%",
            height: "400px",
     
            inserting: false,
            editing: true,
            sorting: true,
            paging: true,
            autoload: true,
            selecting: true,
            heading: true,
            deleteButton : false,
            filtering: true,
     
            loadIndicator: {
                show: function() {
                    console.log("loading started");
                },
                hide: function() {
                    console.log("loading finished");
                }
            },
            controller : {
                loadData:   function() {
                    var d = $.Deferred();
                   
                    $.ajax({
                        url: "/rateall",
                        dataType: "json"
                    }).done(function(response) {
                        console.log(response.b)
                        data = []
                        Object.keys(response).forEach(function(key){  
                            response[key]["Key"] = key ;
                            response[key]["Path"] = key.split("^")[0];
                            if (key.split("^")[1]    != null) {
                                response[key]["DisplayKey"] = key.split("^")[1].split("|")[0];
                                response[key]["Value"] = key.split("^")[1].split("|")[1];
                            }
                            console.log(response[key]);
                            data.push(response[key]);
                        })
                        d.resolve(data);
                    });
    
                    return d.promise();
                },

                updateItem: function(item) {
                    console.log("Updating " + item);
                    return $.ajax({
                        type: "PUT",
                        url: "/rate",
                        contentType: "text/json",
                        headers: {"apisecret" : "alpha"},
                        data: JSON.stringify(item)
                    });
                }
            },
            //data: clients,    
           

            fields: [
               // { name :"Key", type:"text", readOnly: true},
                { name :"Path", type:"text", readOnly: true},
                { name :"DisplayKey", type:"text", readOnly: true},
                { name :"Value", type:"text", readOnly: true},
                { name: "Window", type: "number", width: 150, validate: "required" },
                { name: "Limit", type: "number", width: 50 },
                { name: "PeakAveraged", type: "text", width: 200 },
                { name: "Keys", type: "text"  },
                { name: "DefaultResponse", type: "text" },
                { name: "DefaultHeaders", type: "text"},
                { type: "control" }
            ]
        });
        });
     
       
    </script>
</head>
<body style="background-image: url('ui/lib/background.jpg'); background-size: cover;background-repeat: no-repeat;background-position: center;">
    
    <div id="jsGrid" class="divcenter" style="opacity: 100%; top: 40%;position: fixed;"></div>

</body>

</html>